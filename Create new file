<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ç‰©è²©ç®¡ç†è¡¨ ã‚¹ãƒãƒ›å¯¾å¿œç‰ˆ</title>

<style>
body{font-family:sans-serif;background:#f4f6f9;margin:0;}
header{
display:flex;
justify-content:space-around;
background:#1976d2;
color:white;
padding:12px;
font-weight:bold;
position:sticky;
top:0;
z-index:100;
}
header button{
background:none;
border:none;
color:white;
font-size:16px;
font-weight:bold;
}

.page{display:none;padding:12px;}
.active{display:block;}

.box{background:white;padding:12px;border-radius:10px;
box-shadow:0 3px 8px rgba(0,0,0,0.15);}

input,select,button{
width:100%;
padding:10px;
margin:6px 0;
border-radius:8px;
border:1px solid #ccc;
font-size:16px;
}

button{background:#1976d2;color:white;border:none;}
button:hover{opacity:0.9;}

.deleteBtn{background:#dc3545;}
.editBtn{background:#28a745;}
.soldBtn{background:#ff9800;}
.undoBtn{background:#6c757d;}

table{width:100%;border-collapse:collapse;font-size:13px;margin-top:10px;}
th,td{border:1px solid #ccc;padding:5px;text-align:center;}
thead th{background:#1976d2;color:white;position:sticky;top:0;}

.monthHeader{
background:#444;
color:white;
cursor:pointer;
font-weight:bold;
}

.hiddenRow{display:none;}
.plus{color:green;font-weight:bold;}
.minus{color:red;font-weight:bold;}
.summary{margin-top:10px;font-weight:bold;}
.reportBox{margin-top:15px;background:#eef2f7;padding:10px;border-radius:10px;}
.totalRow{background:#ddd;font-weight:bold;}
.listing{background:#eee;color:#666;}
</style>
</head>

<body>

<header>
<button onclick="showPage('inputPage')">ğŸ“¥ç‰©è²©å…¥åŠ›</button>
<button onclick="showPage('listPage')">ğŸ“¦ç‰©è²©ç®¡ç†è¡¨</button>
<button onclick="showPage('calcPage')">ğŸ§®åˆ©ç›Šè¨ˆç®—</button>
</header>

<!-- ================= ç‰©è²©å…¥åŠ› ================= -->
<div id="inputPage" class="page active">
<h2>ğŸ“¥ ç‰©è²©å…¥åŠ›</h2>
<div class="box">

<input id="product" placeholder="å•†å“å">

<select id="category">
<option value="">ã‚«ãƒ†ã‚´ãƒª</option>
<option>ä¸ç”¨å“</option><option>æ ¼å®‰</option>
<option>Amazon</option><option>ã‚¢ãƒ‘ãƒ¬ãƒ«</option>
<option>å›½éš›è¼¸å…¥</option><option>ç„¡åœ¨åº«</option>
<option>ãƒ–ãƒ©ãƒ³ãƒ‰</option>
</select>

<select id="platform">
<option value="">å‡ºå“å ´æ‰€</option>
<option>ãƒ¡ãƒ«ã‚«ãƒª</option>
<option>Yahooï¼ãƒ•ãƒªãƒ</option>
<option>ãƒ©ã‚¯ãƒ</option>
<option>ãƒ¤ãƒ•ã‚ªã‚¯</option>
<option>ã‚¸ãƒ¢ãƒ†ã‚£</option>
</select>

<input id="cost" type="number" placeholder="ä»•å…¥">
<input id="sales" type="number" placeholder="å£²ä¸Šï¼ˆç©ºãªã‚‰å‡ºå“ä¸­ï¼‰">

<select id="shipping">
<option value="0">é€æ–™é¸æŠ</option>
<option value="160">ã‚†ã†ãƒ‘ã‚±ãƒƒãƒˆmini160</option>
<option value="215">ã‚†ã†ãƒ‘ã‚±ãƒƒãƒˆãƒã‚¹ãƒˆ215</option>
<option value="230">ã‚†ã†ãƒ‘ã‚±ãƒƒãƒˆ230</option>
<option value="455">ã‚†ã†ãƒ‘ã‚±ãƒƒãƒˆãƒ—ãƒ©ã‚¹455</option>
<option value="210">ãƒã‚³ãƒã‚¹210</option>
<option value="450">å®…æ€¥ä¾¿ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆ450</option>
</select>

<input id="shippingManual" type="number" placeholder="é€æ–™ æ‰‹å…¥åŠ›">
<input id="manualFee" type="number" placeholder="æ‰‹æ•°æ–™ æ‰‹å…¥åŠ›">

å‡ºå“æ—¥:<input id="listDate" type="date">
å£²ä¸Šæ—¥:<input id="saleDate" type="date">

<button id="addBtn">è¿½åŠ </button>

</div>
</div>

<!-- ================= ç‰©è²©ç®¡ç†è¡¨ ================= -->
<div id="listPage" class="page">
<h2>ğŸ“¦ ç‰©è²©ç®¡ç†è¡¨</h2>
<div class="box">

<table>
<thead>
<tr>
<th>çŠ¶æ…‹</th><th>å‡ºå“æ—¥</th><th>å£²ä¸Šæ—¥</th>
<th>å•†å“</th><th>ã‚«ãƒ†ã‚´ãƒª</th><th>å ´æ‰€</th>
<th>ä»•å…¥</th><th>å£²ä¸Š</th>
<th>é€æ–™</th><th>æ‰‹æ•°æ–™</th>
<th>åˆ©ç›Š</th><th>åˆ©ç›Šç‡</th>
<th>æ“ä½œ</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>

<div class="summary">
ä»•å…¥åˆè¨ˆ Â¥<span id="sumCost">0</span><br>
å£²ä¸Šåˆè¨ˆ Â¥<span id="sumSales">0</span><br>
åˆ©ç›Šåˆè¨ˆ Â¥<span id="sumProfit">0</span>
</div>

<hr>

<div class="reportBox">
<h3>ğŸ“Š å£²ä¸Šãƒ¬ãƒãƒ¼ãƒˆ</h3>
å¹´åº¦:<select id="repYear"></select>
æœˆ:
<select id="repMonth">
<option value="all">å¹´é–“</option>
<option value="01">1æœˆ</option><option value="02">2æœˆ</option>
<option value="03">3æœˆ</option><option value="04">4æœˆ</option>
<option value="05">5æœˆ</option><option value="06">6æœˆ</option>
<option value="07">7æœˆ</option><option value="08">8æœˆ</option>
<option value="09">9æœˆ</option><option value="10">10æœˆ</option>
<option value="11">11æœˆ</option><option value="12">12æœˆ</option>
</select>
<button id="makeReportBtn">ãƒ¬ãƒãƒ¼ãƒˆä½œæˆ</button>
<div id="reportResult"></div>
</div>

</div>
</div>

<!-- ================= åˆ©ç›Šè¨ˆç®— ================= -->
<div id="calcPage" class="page">
<h2>ğŸ§® åˆ©ç›Šè¨ˆç®—</h2>
<div class="box">

<input type="number" id="c_cost" placeholder="ä»•å…¥ã‚Œå€¤">
<input type="number" id="c_price" placeholder="è²©å£²ä¾¡æ ¼">

<select id="c_feeSelect">
<option value="0.10">ãƒ¡ãƒ«ã‚«ãƒªï¼ˆ10%ï¼‰</option>
<option value="0.05">Yahooãƒ•ãƒªãƒï¼ˆ5%ï¼‰</option>
<option value="0.10">ãƒ¤ãƒ•ã‚ªã‚¯ï¼ˆ10%ï¼‰</option>
<option value="custom">æ‰‹å…¥åŠ›</option>
</select>
<input type="number" id="c_customFee" placeholder="æ‰‹æ•°æ–™ï¼…å…¥åŠ›" style="display:none;">

<select id="c_shipSelect">
<option value="160">ã‚†ã†ãƒ‘ã‚±ãƒƒãƒˆmini160</option>
<option value="215">ã‚†ã†ãƒ‘ã‚±ãƒƒãƒˆãƒã‚¹ãƒˆ215</option>
<option value="230">ã‚†ã†ãƒ‘ã‚±ãƒƒãƒˆ230</option>
<option value="455">ã‚†ã†ãƒ‘ã‚±ãƒƒãƒˆãƒ—ãƒ©ã‚¹455</option>
<option value="210">ãƒã‚³ãƒã‚¹210</option>
<option value="450">å®…æ€¥ä¾¿ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆ450</option>
<option value="custom">æ‰‹å…¥åŠ›</option>
</select>
<input type="number" id="c_customShip" placeholder="é€æ–™å…¥åŠ›" style="display:none;">

<p>åˆ©ç›Šï¼š<span id="c_profit">0</span> å††</p>
<p>åˆ©ç›Šç‡ï¼š<span id="c_rate">0</span> %</p>

</div>
</div>

<script>
/* ===== ãƒšãƒ¼ã‚¸åˆ‡æ›¿ ===== */
function showPage(id){
document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
document.getElementById(id).classList.add("active");
}

/* ===== å…ƒç‰©è²©ãƒ­ã‚¸ãƒƒã‚¯å®Œå…¨ç¶­æŒ ===== */
let data=JSON.parse(localStorage.getItem("buppan"))||[];
let editIndex=null;
const today=new Date().toISOString().slice(0,10);
document.getElementById("listDate").value=today;

function save(){localStorage.setItem("buppan",JSON.stringify(data));}

function calcFee(item){
if(item.sales<=0)return 0;
if(item.platform==="ãƒ¡ãƒ«ã‚«ãƒª"||item.platform==="ãƒ¤ãƒ•ã‚ªã‚¯")
return Math.floor(item.sales*0.10);
if(item.platform==="Yahooï¼ãƒ•ãƒªãƒ")
return Math.floor(item.sales*0.05);
return item.manualFee||0;
}

function calcProfit(item){
return item.sales-item.cost-item.shipping-calcFee(item);
}

function toggleMonth(cls){
document.querySelectorAll("."+cls)
.forEach(r=>r.classList.toggle("hiddenRow"));
}

function render(){
tableBody.innerHTML="";
let sumC=0,sumS=0,sumP=0;
let soldByMonth={}, listing=[];

data.forEach((item,i)=>{
if(item.sales>0 && item.saleDate){
let key=item.saleDate.slice(0,7);
if(!soldByMonth[key])soldByMonth[key]=[];
soldByMonth[key].push({item,i});
}else{
listing.push({item,i});
}
});

listing.sort((a,b)=>new Date(b.item.listDate||0)-new Date(a.item.listDate||0));

Object.keys(soldByMonth).forEach(month=>{
soldByMonth[month].sort((a,b)=>new Date(b.item.saleDate)-new Date(a.item.saleDate));
});

listing.forEach(obj=>{
let tr=createRow(obj.item,obj.i);
tr.classList.add("listing");
tableBody.appendChild(tr);
});

Object.keys(soldByMonth)
.sort((a,b)=>b.localeCompare(a))
.forEach(month=>{
let header=document.createElement("tr");
header.innerHTML=
`<td colspan="13" class="monthHeader"
onclick="toggleMonth('m${month.replace('-','')}')">
ğŸ“… ${month} å£²ä¸Šæ¸ˆï¼ˆ${soldByMonth[month].length}ä»¶ï¼‰
</td>`;
tableBody.appendChild(header);

soldByMonth[month].forEach(obj=>{
let tr=createRow(obj.item,obj.i);
tr.classList.add("m"+month.replace('-',''),"hiddenRow");
tableBody.appendChild(tr);
});
});

data.forEach(item=>{
sumC+=item.cost;
sumS+=item.sales;
if(item.sales>0)sumP+=calcProfit(item);
});

sumCost.textContent=sumC;
sumSales.textContent=sumS;
sumProfit.textContent=sumP;

save();
populateYears();
}

function createRow(item,i){
let sold=item.sales>0;
let profit=sold?calcProfit(item):0;
let rate=sold?((profit/item.sales)*100).toFixed(1)+"%":"-";

let tr=document.createElement("tr");
tr.innerHTML=`
<td>${sold?"å£²ä¸Šæ¸ˆ":"å‡ºå“ä¸­"}</td>
<td>${item.listDate||""}</td>
<td>${sold?item.saleDate:"-"}</td>
<td>${item.product}</td>
<td>${item.category}</td>
<td>${item.platform}</td>
<td>Â¥${item.cost}</td>
<td>${sold?"Â¥"+item.sales:"-"}</td>
<td>Â¥${item.shipping}</td>
<td>${sold?"Â¥"+calcFee(item):"-"}</td>
<td class="${profit>=0?"plus":"minus"}">
${sold?"Â¥"+profit:"-"}</td>
<td>${rate}</td>
<td>
${!sold?`<button class="soldBtn"
onclick="markSold(${i})">å£²ä¸Šæ¸ˆ</button>`:""}
${sold?`<button class="undoBtn"
onclick="undoSold(${i})">å–æ¶ˆ</button>`:""}
<button class="editBtn"
onclick="editItem(${i})">ç·¨é›†</button>
<button class="deleteBtn"
onclick="delItem(${i})">å‰Šé™¤</button>
</td>`;
return tr;
}

document.getElementById("addBtn").onclick=function(){
let obj={
product:product.value,
category:category.value,
platform:platform.value,
cost:Number(cost.value||0),
sales:Number(sales.value||0),
shipping:Number(shippingManual.value||shipping.value||0),
manualFee:Number(manualFee.value||0),
listDate:listDate.value,
saleDate:saleDate.value
};
if(editIndex!==null){
data[editIndex]=obj;
editIndex=null;
}else{
data.push(obj);
}
product.value=category.value=platform.value="";
cost.value=sales.value="";
shipping.value="0";
shippingManual.value="";
manualFee.value="";
saleDate.value="";
render();
showPage("listPage");
};

window.editItem=function(i){
let it=data[i];
product.value=it.product;
category.value=it.category;
platform.value=it.platform;
cost.value=it.cost;
sales.value=it.sales||"";
shipping.value=it.shipping;
manualFee.value=it.manualFee||"";
listDate.value=it.listDate||today;
saleDate.value=it.saleDate||"";
editIndex=i;
showPage("inputPage");
};

window.delItem=function(i){data.splice(i,1);render();}
window.markSold=function(i){
let price=prompt("å£²ä¸Šé‡‘é¡ã‚’å…¥åŠ›");
if(!price)return;
data[i].sales=parseInt(price);
data[i].saleDate=today;
render();
};
window.undoSold=function(i){
data[i].sales=0;
data[i].saleDate="";
render();
};

/* ===== ãƒ¬ãƒãƒ¼ãƒˆï¼ˆåˆ©ç›Šç‡è¿½åŠ æ¸ˆï¼‰ ===== */
document.getElementById("makeReportBtn").onclick=function(){
let y=repYear.value;
let m=repMonth.value;
let cats=["ä¸ç”¨å“","æ ¼å®‰","Amazon","ã‚¢ãƒ‘ãƒ¬ãƒ«","å›½éš›è¼¸å…¥","ç„¡åœ¨åº«","ãƒ–ãƒ©ãƒ³ãƒ‰"];
let sum={};
cats.forEach(c=>sum[c]={sales:0,profit:0});

data.forEach(d=>{
if(d.sales>0 && d.saleDate){
let [yy,mm]=d.saleDate.split("-");
if(yy===y&&(m==="all"||mm===m)){
sum[d.category].sales+=d.sales;
sum[d.category].profit+=calcProfit(d);
}
}
});

let html="<table><tr><th>é …ç›®</th>";
cats.forEach(c=>html+=`<th>${c}</th>`);
html+="</tr>";

html+="<tr><th>å£²ä¸Š</th>";
cats.forEach(c=>html+=`<td>Â¥${sum[c].sales}</td>`);
html+="</tr>";

html+="<tr><th>åˆ©ç›Š</th>";
cats.forEach(c=>html+=`<td>Â¥${sum[c].profit}</td>`);
html+="</tr>";

html+="<tr><th>åˆ©ç›Šç‡</th>";
cats.forEach(c=>{
let rate=sum[c].sales>0?
((sum[c].profit/sum[c].sales)*100).toFixed(1)+"%":"-";
html+=`<td>${rate}</td>`;
});
html+="</tr>";

let totalS=0,totalP=0;
cats.forEach(c=>{
totalS+=sum[c].sales;
totalP+=sum[c].profit;
});
let totalRate=totalS>0?
((totalP/totalS)*100).toFixed(1):"-";

html+=`<tr class="totalRow">
<td>åˆè¨ˆ</td>
<td colspan="${cats.length}">
å£²ä¸Š Â¥${totalS} ï¼ åˆ©ç›Š Â¥${totalP} ï¼ åˆ©ç›Šç‡ ${totalRate}%
</td></tr></table>`;

reportResult.innerHTML=html;
};

function populateYears(){
let ys=[...new Set(data.filter(d=>d.saleDate)
.map(d=>d.saleDate.split("-")[0]))];
if(ys.length===0)ys=[today.split("-")[0]];
repYear.innerHTML=ys.map(y=>`<option>${y}</option>`).join("");
}

/* ===== ã›ã©ã‚Šè¨ˆç®— ===== */
function updateSedori(){
let cost=Number(c_cost.value||0);
let price=Number(c_price.value||0);

let feeRate;
if(c_feeSelect.value==="custom"){
feeRate=Number(c_customFee.value||0)/100;
}else{
feeRate=Number(c_feeSelect.value);
}

let ship;
if(c_shipSelect.value==="custom"){
ship=Number(c_customShip.value||0);
}else{
ship=Number(c_shipSelect.value);
}

let fee=price*feeRate;
let profit=price-fee-ship-cost;
let rate=price>0?((profit/price)*100):0;

c_profit.textContent=profit.toFixed(0);
c_rate.textContent=rate.toFixed(1);
}

c_feeSelect.onchange=function(){
c_customFee.style.display=this.value==="custom"?"block":"none";
updateSedori();
};
c_shipSelect.onchange=function(){
c_customShip.style.display=this.value==="custom"?"block":"none";
updateSedori();
};

["c_cost","c_price","c_customFee","c_customShip"]
.forEach(id=>document.getElementById(id).oninput=updateSedori);

render();
</script>

</body>
</html>
